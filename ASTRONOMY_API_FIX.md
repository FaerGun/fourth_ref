# Исправление ошибки AstronomyAPI 403

## Проблема

При запросе к AstronomyAPI возвращается ошибка 403 (Forbidden):
```json
{
  "error": "API request failed",
  "code": 403
}
```

## Возможные причины

1. **Неправильные credentials** - `ASTRO_APP_ID` или `ASTRO_APP_SECRET` неверны или истекли
2. **Проблема с форматом аутентификации** - Basic Auth может быть неправильно сформирован
3. **Ограничения API** - возможно, превышен лимит запросов или требуется платная подписка

## Выполненные исправления

### 1. Улучшена обработка ошибок в `AstronomyApiService`
- Добавлена более детальная информация об ошибках
- Специальная обработка для 403 ошибки
- Логирование полного ответа API для отладки

### 2. Улучшена обработка ошибок на фронтенде
- Отображение понятных сообщений об ошибках
- Показ кода ошибки для диагностики

### 3. Нормализация ответа API
- Добавлена нормализация структуры ответа для фронтенда
- Обработка различных форматов ответа от API

## Проверка credentials

```bash
# Проверить, установлены ли переменные окружения
docker-compose exec php php -r "echo getenv('ASTRO_APP_ID') ? 'SET' : 'NOT SET';"
docker-compose exec php php -r "echo getenv('ASTRO_APP_SECRET') ? 'SET' : 'NOT SET';"
```

## Решение проблемы 403

### Вариант 1: Проверить credentials
1. Зарегистрируйтесь на https://astronomyapi.com/
2. Получите новые `ASTRO_APP_ID` и `ASTRO_APP_SECRET`
3. Обновите переменные в `.env` или `docker-compose.yml`

### Вариант 2: Проверить лимиты API
- Убедитесь, что у вас есть активная подписка
- Проверьте лимиты запросов в личном кабинете

### Вариант 3: Временное решение
Если API недоступен, можно:
- Показывать заглушку с сообщением
- Использовать мок-данные для разработки
- Отключить секцию астрономических событий

## Текущий статус

✅ **Обработка ошибок улучшена**
✅ **Логирование добавлено**
⚠️ **Требуется проверка credentials** - возможно, нужны новые ключи API

## Следующие шаги

1. Проверьте логи: `docker-compose logs php --tail 50 | grep -i astro`
2. Проверьте credentials в `docker-compose.yml`
3. При необходимости получите новые ключи на https://astronomyapi.com/
4. Обновите переменные окружения и перезапустите контейнеры


